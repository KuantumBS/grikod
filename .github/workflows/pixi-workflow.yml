name: Pixi CI

on:
  push:
    branches: [ main, dev ]
  pull_request:
    branches: [ main ]

jobs:
  test-and-build:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest]  # Ä°sterseniz: [ubuntu-latest, macos-latest]
        python-version: ["3.11", "3.12", "3.13", "3.14"]
      fail-fast: false

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}

      - name: ğŸš€ Install Pixi
        uses: prefix-dev/setup-pixi@v0.8
        with:
          pixi-version: "latest"

      - name: ğŸ§  Cache Pixi environments & cache
        uses: actions/cache@v4
        with:
          path: |
            ~/.cache/pixi
            ~/.pixi/envs
          key: ${{ runner.os }}-pixi-${{ hashFiles('pixi.lock') }}
          restore-keys: |
            ${{ runner.os }}-pixi-

      - name: ğŸ“¦ Install dependencies
        run: pixi install --frozen

      - name: ğŸ”§ Install package in editable mode
        run: pixi run pip install -e .

      - name: ğŸ§ª Run tests
        run: pixi run test

      - name: ğŸ—ï¸ Build package (wheel + sdist)
        run: pixi run build
        # Gerekiyorsa `build` gÃ¶revini pixi.toml'da tanÄ±mlamÄ±ÅŸ olmalÄ±sÄ±nÄ±z:
        # [tasks]
        # build = "python -m build"

      - name: ğŸ“¤ Upload build artifacts
        uses: actions/upload-artifact@v4
        with:
          name: grikod-dist-${{ matrix.os }}-py${{ matrix.python-version }}
          path: dist/
          if-no-files-found: ignore
